#---- begin snakebids boilerplate ----------------------------------------------

import snakebids
from snakebids import bids
# from niworkflows.interface.surf import GiftiToCSV, CSVToGifti
from os.path import join
import os
import pandas as pd 

configfile: 'config/snakebids.yml'

#writes inputs_config.yml and updates config dict
config.update(
    snakebids.generate_inputs(
        bids_dir=config["bids_dir"],
        pybids_inputs=config["pybids_inputs"],
        derivatives=config["derivatives"],
        participant_label=config["participant_label"],
        exclude_participant_label=config["exclude_participant_label"]
    )
)



#this adds constraints to the bids naming
wildcard_constraints:  **snakebids.get_wildcard_constraints(\
    config["pybids_inputs"]\
)

#---- end snakebids boilerplate ------------------------------------------------

rule all:
    input: 
        # expand(directory(
        #     bids(
        #         root = "result",
        #         dataype = 'xcpengine'
        #         **config['input_wildcards']['bold_volume']
        #     )), 
        #     **config['input_lists']['bold_volume']
        # ),
        expand(bids(
            root = "results",
            datatype = "func",
            hemi = "{hemi}",
            space = "MNI152NLin2009cAsym",
            den = "{density}",
            suffix = "bold.func.gii",
            **config["input_wildcards"]['reverse_transform']),
            density=config['density'],
            hemi = config['hemi'],
            **config['input_lists']['reverse_transform']),
        expand(bids(
            root = "results",
            datatype = "func",
            hemi = "{hemi}",
            space = "MNI152NLin2009cAsym",
            density = "{density}",
            desc = "aligned",
            suffix = "gradients.func.gii",
            **config["input_wildcards"]['reverse_transform']), 
            density=config['density'],
            hemi = config['hemi'],
            **config['input_lists']['reverse_transform']),
        expand(bids(
            root = "work",
            datatype = "func",
            hemi = "{hemi}",
            den = "{density}",
            suffix = "func.done",
            **config["input_wildcards"]['reverse_transform']), 
            density=config['density'],
            hemi = config['hemi'],
            **config['input_lists']['reverse_transform']),

# include: 'rules/xcp_engine.smk'

include: 'rules/post_hippunfold.smk'

include: 'rules/post_fmriprep_xcpengine.smk'


